generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  DEVOTEE
  INSTITUTION
  SELLER
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique // For Admin
  password      String?   // For Admin (Hashed)
  phone         String?   // For Devotee, Institution, Seller
  profileImage  String?
  otp           String?
  otpExpires    DateTime?
  role          UserRole  @default(DEVOTEE)
  isVerified    Boolean   @default(false)

  
  // Relationships
  temple        Temple?   // If role is INSTITUTION
  favorites     Favorite[]
  // sellerProfile Seller?  // Future: If role is SELLER

  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@unique([phone, role])
}

model Temple {
  id           String   @id @default(cuid())
  name         String
  location     String
  fullAddress  String?
  description  String
  history      String?
  image        String?
  heroImages   String[] 
  gallery      String[] 
  rating       Float    @default(0)
  reviewsCount Int      @default(0)
  category     String
  liveStatus   Boolean  @default(false)
  openTime     String
  phone        String?
  website      String?
  mapUrl       String?
  viewers      String?
  isLive       Boolean  @default(false)
  templeId     String?  @unique // Custom Unique ID e.g. TMP-A8X92B
  
  // Link to User (Institution Owner)
  userId       String   @unique
  user         User     @relation(fields: [userId], references: [id])
  
  poojas       Pooja[]
  events       Event[]
  products     Product[]
  favorites    Favorite[]
  createdAt    DateTime @default(now())

  updatedAt    DateTime @updatedAt

  updateRequests TempleUpdateRequest[]
}

model TempleUpdateRequest {
  id            String   @id @default(cuid())
  templeId      String
  temple        Temple   @relation(fields: [templeId], references: [id], onDelete: Cascade)
  requestedData Json     // Store the changes JSON
  oldData       Json     // Store current values for comparison
  status        String   @default("PENDING") // PENDING, APPROVED, REJECTED
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Pooja {
  id            String   @id @default(cuid())
  name          String
  category      String
  price         Float
  duration      String
  description   String[]
  time          String
  image         String?
  about         String?
  benefits      String[]
  bullets       String[]
  process       String?
  processSteps  Json?    
  templeId      String
  temple        Temple   @relation(fields: [templeId], references: [id])
  templeDetails String?
  packages      Json?    
  faqs          Json?    
  reviews       Json?    
  favorites     Favorite[]
  status        Boolean  @default(true)
  createdAt     DateTime @default(now())

  updatedAt     DateTime @updatedAt
}

model Event {
  id          String   @id @default(cuid())
  name        String
  date        String
  description String?
  
  // Link to Temple (Institution)
  templeId    String
  temple      Temple   @relation(fields: [templeId], references: [id], onDelete: Cascade)
  status      Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Banner {
  id        String   @id @default(cuid())
  image     String
  link      String?
  active    Boolean  @default(true)
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Feature {
  id          String   @id @default(cuid())
  title       String
  description String
  image       String // Background image for the feature card
  icon        String // Icon image for the feature card
  active      Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Testimonial {
  id          String   @id @default(cuid())
  title       String
  subtitle    String
  videoSrc    String
  thumbnail   String
  category    String
  active      Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Product {
  id          String   @id @default(cuid())
  name        String
  description String
  category    String
  status      String   @default("pending") // pending, approved, rejected
  image       String?
  
  // Link to Temple (optional - admin can create products without temple)
  templeId    String?
  temple      Temple?  @relation(fields: [templeId], references: [id], onDelete: Cascade)
  
  // Relations
  variants    ProductVariant[]
  favorites   Favorite[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ProductVariant {
  id        String   @id @default(cuid())
  name      String   // e.g., "Small", "Medium", "Large", "Red", "Blue"
  price     Float
  stock     Int      @default(0)
  image     String?
  
  // Link to Product
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Favorite {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  templeId  String?
  temple    Temple?  @relation(fields: [templeId], references: [id], onDelete: Cascade)
  poojaId   String?
  pooja     Pooja?   @relation(fields: [poojaId], references: [id], onDelete: Cascade)
  productId String?
  product   Product? @relation(fields: [productId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  // Ensure unique favorites per user
  @@unique([userId, templeId])
  @@unique([userId, poojaId])
  @@unique([userId, productId])
}

model CTACard {
  id          String   @id @default(cuid())
  title       String
  points      String[] // Array of bullet points
  icon        String   // Icon/image URL
  buttonText  String
  buttonLink  String
  cardType    String   // "primary" or "secondary" for styling
  active      Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}


